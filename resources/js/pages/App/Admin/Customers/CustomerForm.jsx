import React, { useState } from 'react';
import 'bootstrap/dist/css/bootstrap.min.css';
import { IconButton, Button, Grid, Typography, Box, TextField, MenuItem } from '@mui/material';
import { ArrowBack as ArrowBackIcon } from '@mui/icons-material';
import { router, usePage, useForm } from '@inertiajs/react';
import AsyncSearchTextField from '@/components/AsyncSearchTextField';

const genderOptions = ['male', 'female', 'other'];

// const drawerWidthOpen = 240;
// const drawerWidthClosed = 110;

const CustomerForm = ({ customer = {}, customerNo, guestTypes = [], isEdit = false }) => {
    // const [open, setOpen] = useState(true);
    const { data, setData, post, put, processing, errors } = useForm({
        customer_no: customer.customer_no || customerNo || '',
        name: customer.name || '',
        address: customer.address || '',
        gender: customer.gender || '',
        cnic: customer.cnic || '',
        contact: customer.contact || '',
        email: customer.email || '',
        guest_type_id: customer.guest_type_id || '',
        member_name: customer.member_name || '',
        member_no: customer.member_no || '',
        guest: customer.member_name ? { name: customer.member_name, label: customer.member_name, membership_no: customer.member_no } : null,
    });

    const handleChange = (e) => {
        const newData = e.target.value;
        setData('member_name', newData?.name);
        setData('member_no', newData?.membership_no);
    };

    const handleSubmit = (e) => {
        e.preventDefault();
        isEdit ? put(route('customers.update', customer.id)) : post(route('guests.store'));
    };

    return (
        <>
            {/* <SideNav open={open} setOpen={setOpen} /> */}
            <Box
                sx={{
                    minHeight: '100vh',
                    padding: '20px',
                    backgroundColor: '#f5f5f5',
                }}
            >
                <Box sx={{ display: 'flex', alignItems: 'center' }} onClick={() => router.visit(route('guests.index'))}>
                    <IconButton>
                        <ArrowBackIcon sx={{ color: '#555' }} />
                    </IconButton>
                    <Typography variant="h5" sx={{ fontWeight: 500, color: '#333' }}>
                        {isEdit ? 'Edit Customer' : 'Add Customer'}
                    </Typography>
                </Box>

                <Box component="form" onSubmit={handleSubmit} sx={{ maxWidth: 600, mx: 'auto', mt: 3, bgcolor: '#fff', p: 3 }}>
                    <Grid container spacing={2}>
                        <Grid item xs={12} sm={6}>
                            <TextField
                                fullWidth
                                label="Customer No"
                                margin="normal"
                                value={data.customer_no}
                                disabled
                                error={!!errors.customer_no}
                                helperText={errors.customer_no}
                                sx={{
                                    width: '100%',
                                    '& .MuiInputBase-root': {
                                        height: 35,
                                        display: 'flex',
                                        alignItems: 'center',
                                    },
                                    '& .MuiSelect-select': {
                                        display: 'flex',
                                        alignItems: 'center',
                                        padding: '0 14px !important', // override MUI default
                                        height: '100%',
                                        boxSizing: 'border-box',
                                    },
                                    '& legend': {
                                        display: 'none', // hides outline label gap
                                    },
                                    '& label': {
                                        top: '-10px', // tweak this to move label vertically
                                    },
                                }}
                            />
                        </Grid>

                        <Grid item xs={12} sm={6}>
                            <TextField
                                fullWidth
                                label="Name*"
                                margin="normal"
                                value={data.name}
                                onChange={(e) => setData('name', e.target.value)}
                                error={!!errors.name}
                                helperText={errors.name}
                                sx={{
                                    width: '100%',
                                    '& .MuiInputBase-root': {
                                        height: 35,
                                        display: 'flex',
                                        alignItems: 'center',
                                    },
                                    '& .MuiSelect-select': {
                                        display: 'flex',
                                        alignItems: 'center',
                                        padding: '0 14px !important', // override MUI default
                                        height: '100%',
                                        boxSizing: 'border-box',
                                    },
                                    '& legend': {
                                        display: 'none', // hides outline label gap
                                    },
                                    '& label': {
                                        top: '-10px', // tweak this to move label vertically
                                    },
                                }}
                            />
                        </Grid>

                        <Grid item xs={12} sm={6}>
                            <TextField
                                fullWidth
                                label="Contact*"
                                margin="normal"
                                placeholder="03XXXXXXXX"
                                value={data.contact}
                                onChange={(e) => setData('contact', e.target.value.replace(/[^0-9+\-]/g, ''))}
                                error={!!errors.contact}
                                helperText={errors.contact}
                                sx={{
                                    width: '100%',
                                    '& .MuiInputBase-root': {
                                        height: 35,
                                        display: 'flex',
                                        alignItems: 'center',
                                    },
                                    '& .MuiSelect-select': {
                                        display: 'flex',
                                        alignItems: 'center',
                                        padding: '0 14px !important', // override MUI default
                                        height: '100%',
                                        boxSizing: 'border-box',
                                    },
                                    '& legend': {
                                        display: 'none', // hides outline label gap
                                    },
                                    '& label': {
                                        top: '-10px', // tweak this to move label vertically
                                    },
                                }}
                            />
                        </Grid>

                        <Grid item xs={12} sm={6}>
                            <TextField
                                fullWidth
                                select
                                label="Gender*"
                                margin="normal"
                                value={data.gender}
                                onChange={(e) => setData('gender', e.target.value)}
                                error={!!errors.gender}
                                helperText={errors.gender}
                                sx={{
                                    width: '100%',
                                    '& .MuiInputBase-root': {
                                        height: 35,
                                        display: 'flex',
                                        alignItems: 'center',
                                    },
                                    '& .MuiSelect-select': {
                                        display: 'flex',
                                        alignItems: 'center',
                                        padding: '0 14px !important', // override MUI default
                                        height: '100%',
                                        boxSizing: 'border-box',
                                    },
                                    '& legend': {
                                        display: 'none', // hides outline label gap
                                    },
                                    '& label': {
                                        top: '-10px', // tweak this to move label vertically
                                    },
                                }}
                            >
                                {genderOptions.map((option) => (
                                    <MenuItem key={option} value={option}>
                                        {option}
                                    </MenuItem>
                                ))}
                            </TextField>
                        </Grid>

                        <Grid item xs={12} sm={6}>
                            <TextField
                                fullWidth
                                label="Address"
                                margin="normal"
                                value={data.address}
                                onChange={(e) => setData('address', e.target.value)}
                                sx={{
                                    width: '100%',
                                    '& .MuiInputBase-root': {
                                        height: 35,
                                        display: 'flex',
                                        alignItems: 'center',
                                    },
                                    '& .MuiSelect-select': {
                                        display: 'flex',
                                        alignItems: 'center',
                                        padding: '0 14px !important', // override MUI default
                                        height: '100%',
                                        boxSizing: 'border-box',
                                    },
                                    '& legend': {
                                        display: 'none', // hides outline label gap
                                    },
                                    '& label': {
                                        top: '-10px', // tweak this to move label vertically
                                    },
                                }}
                            />
                        </Grid>

                        <Grid item xs={12} sm={6}>
                            <TextField
                                fullWidth
                                label="CNIC"
                                margin="normal"
                                placeholder="XXXXX-XXXXXXX-X"
                                value={data.cnic}
                                onChange={(e) => {
                                    let value = e.target.value.replace(/\D/g, '');
                                    if (value.length > 5 && value[5] !== '-') value = value.slice(0, 5) + '-' + value.slice(5);
                                    if (value.length > 13 && value[13] !== '-') value = value.slice(0, 13) + '-' + value.slice(13);
                                    if (value.length > 15) value = value.slice(0, 15);
                                    setData('cnic', value);
                                }}
                                sx={{
                                    width: '100%',
                                    '& .MuiInputBase-root': {
                                        height: 35,
                                        display: 'flex',
                                        alignItems: 'center',
                                    },
                                    '& .MuiSelect-select': {
                                        display: 'flex',
                                        alignItems: 'center',
                                        padding: '0 14px !important', // override MUI default
                                        height: '100%',
                                        boxSizing: 'border-box',
                                    },
                                    '& legend': {
                                        display: 'none', // hides outline label gap
                                    },
                                    '& label': {
                                        top: '-10px', // tweak this to move label vertically
                                    },
                                }}
                            />
                        </Grid>

                        <Grid item xs={12} sm={6}>
                            <TextField
                                fullWidth
                                label="Email"
                                margin="normal"
                                value={data.email}
                                onChange={(e) => setData('email', e.target.value)}
                                sx={{
                                    width: '100%',
                                    '& .MuiInputBase-root': {
                                        height: 35,
                                        display: 'flex',
                                        alignItems: 'center',
                                    },
                                    '& .MuiSelect-select': {
                                        display: 'flex',
                                        alignItems: 'center',
                                        padding: '0 14px !important', // override MUI default
                                        height: '100%',
                                        boxSizing: 'border-box',
                                    },
                                    '& legend': {
                                        display: 'none', // hides outline label gap
                                    },
                                    '& label': {
                                        top: '-10px', // tweak this to move label vertically
                                    },
                                }}
                            />
                        </Grid>

                        <Grid item xs={12} sm={6}>
                            <TextField
                                fullWidth
                                select
                                label="Guest Type*"
                                margin="normal"
                                value={data.guest_type_id}
                                onChange={(e) => setData('guest_type_id', e.target.value)}
                                error={!!errors.guest_type_id}
                                helperText={errors.guest_type_id}
                                sx={{
                                    width: '100%',
                                    '& .MuiInputBase-root': {
                                        height: 35,
                                        display: 'flex',
                                        alignItems: 'center',
                                    },
                                    '& .MuiSelect-select': {
                                        display: 'flex',
                                        alignItems: 'center',
                                        padding: '0 14px !important', // override MUI default
                                        height: '100%',
                                        boxSizing: 'border-box',
                                    },
                                    '& legend': {
                                        display: 'none', // hides outline label gap
                                    },
                                    '& label': {
                                        top: '-10px', // tweak this to move label vertically
                                    },
                                }}
                            >
                                {guestTypes.map((type) => (
                                    <MenuItem key={type.id} value={type.id}>
                                        {type.name}
                                    </MenuItem>
                                ))}
                            </TextField>
                        </Grid>

                        <Grid item xs={12} sm={6}>
                            <Box
                                sx={{
                                    width: '100%',
                                    '& .MuiInputBase-root': { height: 40, alignItems: 'center' },
                                    '& .MuiInputBase-input': { padding: '0 14px' },
                                    '& label': {
                                        top: '-10px', // tweak this to move label vertically
                                    },
                                }}
                            >
                                <AsyncSearchTextField label="Member Name" name="guest" value={data.guest} onChange={handleChange} endpoint="admin.api.search-users" params={{ type: '0' }} placeholder="Search members..." fullWidth />
                            </Box>
                        </Grid>

                        <Grid item xs={12} sm={6} sx={{ mt: -1.4 }}>
                            <TextField
                                fullWidth
                                label="Member No"
                                margin="normal"
                                value={data.member_no}
                                onChange={(e) => setData('member_no', e.target.value)}
                                disabled
                                sx={{
                                    width: '100%',
                                    '& .MuiInputBase-root': {
                                        height: 35,
                                        display: 'flex',
                                        alignItems: 'center',
                                    },
                                    '& .MuiSelect-select': {
                                        display: 'flex',
                                        alignItems: 'center',
                                        padding: '0 14px !important', // override MUI default
                                        height: '100%',
                                        boxSizing: 'border-box',
                                    },
                                    '& legend': {
                                        display: 'none', // hides outline label gap
                                    },
                                    '& label': {
                                        top: '-10px', // tweak this to move label vertically
                                    },
                                }}
                            />
                        </Grid>
                    </Grid>

                    <Box sx={{ display: 'flex', justifyContent: 'flex-end' }}>
                        <Button type="submit" variant="contained" disabled={processing}>
                            {isEdit ? 'Update' : 'Save'}
                        </Button>
                    </Box>
                </Box>
            </Box>
        </>
    );
};

export default CustomerForm;
